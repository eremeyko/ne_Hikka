__version__ = (1, 8, 6)
# meta developer: @eremod
#
#
# 	.----..----. .----..-.   .-. .----. .----.
# 	| {_  | {}  }| {_  |  `.'  |/  {}  \| {}  \
# 	| {__ | .-. \| {__ | |\ /| |\      /|     /
# 	`----'`-' `-'`----'`-' ` `-' `----' `----'
#
#              	¬© Copyright 2024
#          	https://t.me/eremod
#
# üîí      Licensed under the GNU GPLv3
# üåê https://www.gnu.org/licenses/gpl-3.0.html
# Original repository: https://github.com/eremeyko/ne_Hikka

import asyncio
import logging
from ast import literal_eval

from .. import utils, loader
from aiohttp import ClientSession
from typing import Optional
from ..tl_cache import CustomTelegramClient  # type: ignore
from ..database import Database  # type: ignore

from hikkatl.errors import YouBlockedUserError
from hikkatl.functions import messages
from hikkatl.types import (
    Message,
    PeerUser,
    InputMessagesFilterEmpty,
    TypeInputPeer,
)
from telethon import events
from re import search

logger = logging.getLogger(f"LazyYT | {__version__}")


UPDATE_URL: str = "https://github.com/eremeyko/ne_Hikka/raw/master/LazyYouTube.py"


@loader.tds
class LazyYT(loader.Module):
    """Advanced YouTube Media Downloader using @Gozilla_bot"""

    strings = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>You has blocked the bot @Gozilla_bot!</b>\n"
            "Unblock the bot and try again later"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Please provide a valid YouTube link!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>This is not a valid YouTube link!</b>"
        ),
        "no_video": (
            "<emoji document_id=5219901967916084166>üí•</emoji> <b>Unfortunately,"
            "it was not possible to get the video.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Unfortunately, "
            "it was not possible to get the audio.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Here\'s Your <a href="{link}">video:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Quality: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Author: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Here\'s Your <a href="{link}">audio:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Author: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Search your video...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Search your audio...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Downloading video</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Downloading audio</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> New version "
            "update available: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> To update, use: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "Try again in <code>{}</code> minutes or download another video"
        ),
        "_cmd_doc_yt": "[url] - Downloading video from YouTube",
        "_cmd_doc_ytm": "[url] - Downloading audio from YouTube",
    }

    strings_ru = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–í—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞ @Gozilla_bot!</b>\n"
            "–†–∞–∑–±–ª–æ–∫–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –µ—â—ë —Ä–∞–∑"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ YouTube!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–≠—Ç–æ –Ω–µ —Å—Å—ã–ª–∫–∞ –Ω–∞ YouTube!</b>"
        ),
        "no_video": (
            "<emoji document_id=5219901967916084166>üí•</emoji> "
            "<b>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∏–¥–µ–æ.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∞—É–¥–∏–æ.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–í–æ—Ç –í–∞—à–µ <a href="{link}">–≤–∏–¥–µ–æ:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>–ö–∞—á–µ—Å—Ç–≤–æ: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–í–æ—Ç –í–∞—à–µ <a href="{link}">–∞—É–¥–∏–æ:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> –ò–¥—ë—Ç –ø–æ–∏—Å–∫ –≤–∏–¥–µ–æ...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> –ò–¥—ë—Ç –ø–æ–∏—Å–∫ –∞—É–¥–∏–æ...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–°–∫–∞—á–∏–≤–∞—é –≤–∏–¥–µ–æ</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–°–∫–∞—á–∏–≤–∞—é –∞—É–¥–∏–æ</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> –î–æ—Å—Ç—É–ø–Ω–æ "
            "–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –≤–µ—Ä—Å–∏–∏: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> –î–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è "
            "–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: <code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>–°—Ä–∞–±–æ—Ç–∞–ª–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "–≠—Ç–æ –≤–∏–¥–µ–æ —Å–µ–π—á–∞—Å –Ω–µ–ª—å–∑—è —Å–∫–∞—á–∞—Ç—å.\n"
            "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ {minutes} –º–∏–Ω—É—Ç –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –¥—Ä—É–≥–æ–µ –≤–∏–¥–µ–æ"
        ),
        "_cmd_doc_yt": "[—Å—Å—ã–ª–∫–∞] - –°–∫–∞—á–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ –∏–∑ –Æ—Ç—É–±–∞",
        "_cmd_doc_ytm": "[—Å—Å—ã–ª–∫–∞] - –°–∫–∞—á–∏–≤–∞–µ—Ç –º—É–∑—ã–∫—É –∏–∑ –Æ—Ç—É–±–∞",
    }

    # fork codrago only
    strings_uk = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–í–∏ –∑–∞–±–ª–æ–∫—É–≤–∞–ª–∏ –±–æ—Ç–∞ @Gozilla_bot!</b>\n"
            "–†–æ–∑–±–ª–æ–∫—É–π—Ç–µ –±–æ—Ç–∞ —Ç–∞ —Å–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ –ø—ñ–∑–Ω—ñ—à–µ"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ë—É–¥—å –ª–∞—Å–∫–∞, –Ω–∞–¥–∞–π—Ç–µ –¥—ñ–π—Å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ YouTube!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–¶–µ –Ω–µ –¥—ñ–π—Å–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ YouTube!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ù–∞ –∂–∞–ª—å, –Ω–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–µ–æ.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>–ù–∞ –∂–∞–ª—å, –Ω–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –∞—É–¥—ñ–æ.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–û—Å—å –≤–∞—à–µ <a href="{link}">–≤—ñ–¥–µ–æ:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>–Ø–∫—ñ—Å—Ç—å: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–û—Å—å –≤–∞—à–µ <a href="{link}">–∞—É–¥—ñ–æ:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> –®—É–∫–∞—î–º–æ –≤–∞—à–µ –≤—ñ–¥–µ–æ...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> –®—É–∫–∞—î–º–æ –≤–∞—à–µ –∞—É–¥—ñ–æ...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –≤—ñ–¥–µ–æ</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–ó–∞–≤–∞–Ω—Ç–∞–∂—É—é –∞—É–¥—ñ–æ</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> –î–æ—Å—Ç—É–ø–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–≤–æ—ó –≤–µ—Ä—Å—ñ—ó: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> –î–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>–ê–Ω—Ç–∏—Å–ø–∞–º!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "–°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ <code>{}</code> —Ö–≤–∏–ª–∏–Ω –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —ñ–Ω—à–µ –≤—ñ–¥–µ–æ"
        ),
        "_cmd_doc_yt": "[–ø–æ—Å–∏–ª–∞–Ω–Ω—è] - –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤—ñ–¥–µ–æ –∑ YouTube",
        "_cmd_doc_ytm": "[–ø–æ—Å–∏–ª–∞–Ω–Ω—è] - –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î –∞—É–¥—ñ–æ –∑ YouTube",
    }

    strings_fr = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Vous avez bloqu√© le bot @Gozilla_bot!</b>\n"
            "D√©bloquez le bot et r√©essayez plus tard"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Veuillez fournir un lien YouTube valide!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Ceci n'est pas un lien YouTube valide!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Malheureusement, il n'a pas √©t√© possible d'obtenir la vid√©o.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Malheureusement, il n'a pas √©t√© possible d'obtenir l'audio.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Voici votre <a href="{link}">vid√©o:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Qualit√©: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Auteur: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Voici votre <a href="{link}">audio:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Auteur: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Recherche de votre vid√©o...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Recherche de votre audio...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>T√©l√©chargement de la vid√©o</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>T√©l√©chargement de l'audio</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> Nouvelle version disponible: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> Pour mettre √† jour, utilisez: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "R√©essayez dans <code>{}</code> minutes ou t√©l√©chargez une autre vid√©o"
        ),
        "_cmd_doc_yt": "[url] - T√©l√©charge une vid√©o depuis YouTube",
        "_cmd_doc_ytm": "[url] - T√©l√©charge l'audio depuis YouTube",
    }

    strings_it = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Hai bloccato il bot @Gozilla_bot!</b>\n"
            "Sblocca il bot e riprova pi√π tardi"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Per favore, fornisci un link YouTube valido!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Questo non √® un link YouTube valido!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Purtroppo, non √® stato possibile ottenere il video.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Purtroppo, non √® stato possibile ottenere l'audio.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Ecco il tuo <a href="{link}">video:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Qualit√†: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Autore: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Ecco il tuo <a href="{link}">audio:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Autore: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Ricerca del tuo video...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Ricerca del tuo audio...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Download del video</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Download dell'audio</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> Nuova versione disponibile: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> Per aggiornare, usa: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "Riprova tra <code>{}</code> minuti o scarica un altro video"
        ),
        "_cmd_doc_yt": "[url] - Scarica video da YouTube",
        "_cmd_doc_ytm": "[url] - Scarica audio da YouTube",
    }

    strings_de = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Du hast den Bot @Gozilla_bot blockiert!</b>\n"
            "Entsperre den Bot und versuche es sp√§ter erneut"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Bitte gib einen g√ºltigen YouTube-Link an!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Dies ist kein g√ºltiger YouTube-Link!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Leider konnte das Video nicht abgerufen werden.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Leider konnte das Audio nicht abgerufen werden.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Hier ist dein <a href="{link}">Video:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Qualit√§t: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Autor: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Hier ist dein <a href="{link}">Audio:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Autor: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Suche nach deinem Video...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Suche nach deinem Audio...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Video wird heruntergeladen</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Audio wird heruntergeladen</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> Neue Version verf√ºgbar: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> Zum Aktualisieren verwenden: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "Versuche es in <code>{}</code> Minuten erneut oder lade ein anderes Video herunter"
        ),
        "_cmd_doc_yt": "[url] - L√§dt Video von YouTube herunter",
        "_cmd_doc_ytm": "[url] - L√§dt Audio von YouTube herunter",
    }

    strings_tr = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Botu @Gozilla_bot engelledin!</b>\n"
            "Botu engel kaldƒ±r ve daha sonra tekrar dene"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>L√ºtfen ge√ßerli bir YouTube baƒülantƒ±sƒ± saƒülayƒ±n!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Bu ge√ßerli bir YouTube baƒülantƒ±sƒ± deƒüil!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Maalesef video alƒ±namadƒ±.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Maalesef ses alƒ±namadƒ±.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>ƒ∞≈üte <a href="{link}">videonuz:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Kalite: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Yazar: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>ƒ∞≈üte <a href="{link}">sesiniz:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Yazar: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Videonuz aranƒ±yor...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Sesiniz aranƒ±yor...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Video indiriliyor</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Ses indiriliyor</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> Yeni s√ºr√ºm mevcut: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> G√ºncellemek i√ßin kullanƒ±n: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "<code>{}</code> dakika sonra tekrar deneyin veya ba≈üka bir video indirin"
        ),
        "_cmd_doc_yt": "[url] - YouTube'dan video indirir",
        "_cmd_doc_ytm": "[url] - YouTube'dan ses indirir",
    }

    strings_uz = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Siz @Gozilla_bot botini blokladingiz!</b>\n"
            "Botni blokdan chiqaring va keyinroq qayta urinib ko'ring"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Iltimos, amal qiladigan YouTube havolasini taqdim eting!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Bu amal qiladigan YouTube havolasi emas!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Afsuski, video olish mumkin emas edi.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Afsuski, audio olish mumkin emas edi.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Manzilingizdagi <a href="{link}">video:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Sifat: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Muallif: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Manzilingizdagi <a href="{link}">audio:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Muallif: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Videoningiz qidirilmoqda...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Audiyangiz qidirilmoqda...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Video yuklanmoqda</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Audio yuklanmoqda</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> Yangi versiya mavjud: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> Yangilash uchun foydalaning: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "<code>{}</code> daqiqa ichida qayta urinib ko'ring yoki boshqa video yuklab oling"
        ),
        "_cmd_doc_yt": "[havola] - YouTube'dan video yuklash",
        "_cmd_doc_ytm": "[havola] - YouTube'dan audio yuklash",
    }

    strings_es = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>¬°Has bloqueado el bot @Gozilla_bot!</b>\n"
            "Desbloquea el bot y vuelve a intentarlo m√°s tarde"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>¬°Por favor, proporciona un enlace de YouTube v√°lido!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>¬°Este no es un enlace de YouTube v√°lido!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>Lamentablemente, no se pudo obtener el video.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>Lamentablemente, no se pudo obtener el audio.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Aqu√≠ est√° tu <a href="{link}">video:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>Calidad: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Autor: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>Aqu√≠ est√° tu <a href="{link}">audio:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>Autor: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> Buscando tu video...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> Buscando tu audio...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Descargando video</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>Descargando audio</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> ¬°Nueva versi√≥n disponible: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> Para actualizar, usa: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>¬°Antispam!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "Vuelve a intentarlo en <code>{}</code> minutos o descarga otro video"
        ),
        "_cmd_doc_yt": "[url] - Descarga video de YouTube",
        "_cmd_doc_ytm": "[url] - Descarga audio de YouTube",
    }

    strings_kk = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–°—ñ–∑ @Gozilla_bot –±–æ—Ç—ã–Ω –±“±“ì–∞—Ç—Ç–∞–¥—ã“£—ã–∑!</b>\n"
            "–ë–æ—Ç—ã –±“±“ì–∞—Ç—Ç–∞–Ω —à—ã“ì–∞—Ä—ã“£—ã–∑ –∂”ô–Ω–µ –∫–µ–π—ñ–Ω—ñ—Ä–µ–∫ “õ–∞–π—Ç–∞ –±–∞–π“õ–∞–ø –∫”©—Ä—ñ“£—ñ–∑"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ñ–∞—Ä–∞–º–¥—ã YouTube —Å—ñ–ª—Ç–µ–º–µ—Å—ñ–Ω –∫”©—Ä—Å–µ—Ç—ñ“£—ñ–∑!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ë“±–ª –∂–∞—Ä–∞–º–¥—ã YouTube —Å—ñ–ª—Ç–µ–º–µ—Å—ñ –µ–º–µ—Å!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, –±–µ–π–Ω–µ –∞–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>–ö–µ—à—ñ—Ä—ñ“£—ñ–∑, –¥—ã–±—ã—Å –∞–ª—É –º“Ø–º–∫—ñ–Ω –±–æ–ª–º–∞–¥—ã.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–ú—ã–Ω–∞ —Å—ñ–∑–¥—ñ“£ <a href="{link}">–±–µ–π–Ω–µ“£—ñ–∑:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>–°–∞–ø–∞—Å—ã: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä—ã: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–ú—ã–Ω–∞ —Å—ñ–∑–¥—ñ“£ <a href="{link}">–¥—ã–±—ã—Å—ã“£—ã–∑:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä—ã: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> –ë–µ–π–Ω–µ“£—ñ–∑ —ñ–∑–¥–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> –î—ã–±—ã—Å—ã“£—ã–∑ —ñ–∑–¥–µ–ª—ñ–ø –∂–∞—Ç—ã—Ä...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–ë–µ–π–Ω–µ –∂“Ø–∫—Ç–µ–ª—É–¥–µ</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–ê—É–¥–∏–æ –∂“Ø–∫—Ç–µ–ª—É–¥–µ</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> –ñ–∞“£–∞ –Ω“±—Å“õ–∞ “õ–æ–ª–∂–µ—Ç—ñ–º–¥—ñ: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> –ñ–∞“£–∞—Ä—Ç—É “Ø—à—ñ–Ω –ø–∞–π–¥–∞–ª–∞–Ω—ã“£—ã–∑: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>–ê–Ω—Ç–∏—Å–ø–∞–º!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "<code>{}</code> –º–∏–Ω—É—Ç—Ç–∞–Ω –∫–µ–π—ñ–Ω “õ–∞–π—Ç–∞ –±–∞–π“õ–∞–ø –∫”©—Ä—ñ“£—ñ–∑ –Ω–µ–º–µ—Å–µ –±–∞—Å“õ–∞ –±–µ–π–Ω–µ –∂“Ø–∫—Ç–µ–ø –∞–ª—ã“£—ã–∑"
        ),
        "_cmd_doc_yt": "[—Å—ñ–ª—Ç–µ–º–µ] - YouTube-—Ç–µ–Ω –±–µ–π–Ω–µ –∂“Ø–∫—Ç–µ—É",
        "_cmd_doc_ytm": "[—Å—ñ–ª—Ç–µ–º–µ] - YouTube-—Ç–µ–Ω –∞—É–¥–∏–æ –∂“Ø–∫—Ç–µ—É",
    }

    strings_tt = {
        "name": "LazyYouTube",
        "blocked_bot": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–°–µ–∑ @Gozilla_bot –±–æ—Ç—ã–Ω –±–ª–æ–∫–ª–∞–¥—ã–≥—ã–∑!</b>\n"
            "–ë–æ—Ç–Ω—ã –±–ª–æ–∫–ª–∞—Ä–¥–∞–Ω —á—ã–≥–∞—Ä—ã–≥—ã–∑ “ª”ô–º —Å–æ“£—Ä–∞–∫ —è“£–∞–¥–∞–Ω —Ç–µ–ª”ô–ø –∫–∞—Ä–∞–≥—ã–∑"
        ),
        "no_link": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ó–∏–Ω“ª–∞—Ä, –¥”©—Ä–µ—Å YouTube —Å—ã–ª—Ç–∞–º–∞—Å—ã–Ω –±–∏—Ä–µ–≥–µ–∑!</b>"
        ),
        "not_youtube": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ë—É –¥”©—Ä–µ—Å YouTube —Å—ã–ª—Ç–∞–º–∞—Å—ã —Ç“Ø–≥–µ–ª!</b>"
        ),
        "no_video": (
            "<emoji document_id=5213460324425935151>‚ùå</emoji> <b>–ö“Ø–∑”ô—Ç–µ–ª”ô, –≤–∏–¥–µ–æ–Ω—ã –∞–ª—ã–ø –±—É–ª–º—ã–π.</b>"
        ),
        "no_audio": (
            "<emoji document_id=5222472119295684375>üé∂</emoji> <b>–ö“Ø–∑”ô—Ç–µ–ª”ô, –∞—É–¥–∏–æ–Ω—ã –∞–ª—ã–ø –±—É–ª–º—ã–π.</b>"
        ),
        "your_video": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–ú–æ–Ω–¥–∞ —Å–µ–∑–Ω–µ“£ <a href="{link}">–≤–∏–¥–µ–æ:</b></a>\n'
            "{name}\n<emoji document_id=6019295596173596341>üëÅ</emoji> <b>–°—ã–π—Ñ–∞—Ç: </b>{quality} | "
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä: </b>{author}"
        ),
        "your_audio": (
            "<emoji document_id=5775981206319402773>üéû</emoji> "
            '<b>–ú–æ–Ω–¥–∞ —Å–µ–∑–Ω–µ“£ <a href="{link}">–∞—É–¥–∏–æ:</b></a>\n{name}\n'
            "<emoji document_id=5247213725080890199>üìπ</emoji> <b>–ê–≤—Ç–æ—Ä: </b>{author}"
        ),
        "searching_video": "<emoji document_id=5258274739041883702>üîç</emoji> –í–∏–¥–µ–æ —ç–∑–ª”ô–Ω”ô...",
        "searching_audio": "<emoji document_id=5258274739041883702>üîç</emoji> –ê—É–¥–∏–æ —ç–∑–ª”ô–Ω”ô...",
        "downloading_video": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–í–∏–¥–µ–æ –π”©–∫–ª”ô–Ω”ô</b> <code>{name}</code>...",
        "downloading_audio": "<emoji document_id=5213129047084584649>üì•</emoji> <b>–ê—É–¥–∏–æ –π”©–∫–ª”ô–Ω”ô</b> <code>{name}</code>...",
        "update_available": (
            "\n\n<emoji document_id=5771695636411847302>üì¢</emoji> –Ø“£–∞ –≤–µ—Ä—Å–∏—è –±–∞—Ä: {version}!\n<emoji "
            "document_id=5967816500415827773>üíª</emoji> –Ø“£–∞—Ä—Ç—É ”©—á–µ–Ω –∫—É–ª–ª–∞–Ω—ã–≥—ã–∑: "
            "<code>.dlm {url}</code>"
        ),
        "antispam": (
            "<emoji document_id=5220197908342648622>‚ùóÔ∏è</emoji> <b>–ê–Ω—Ç–∏—Å–ø–∞–º!</b>\n"
            "<emoji document_id=5985616167740379273>‚è∞</emoji> "
            "<code>{}</code> –º–∏–Ω—É—Ç—Ç–∞–Ω —Å–æ“£ —è“£–∞–¥–∞–Ω —Ç–µ–ª”ô–ø –∫–∞—Ä–∞–≥—ã–∑ —è–∫–∏ –±–∞—à–∫–∞ –≤–∏–¥–µ–æ–Ω—ã –π”©–∫–ª”ô–≥–µ–∑"
        ),
        "_cmd_doc_yt": "[—Å—ã–ª—Ç–∞–º–∞] - YouTube'—Ç–∞–Ω –≤–∏–¥–µ–æ –π”©–∫–ª”ô“Ø",
        "_cmd_doc_ytm": "[—Å—ã–ª—Ç–∞–º–∞] - YouTube'—Ç–∞–Ω –∞—É–¥–∏–æ –π”©–∫–ª”ô“Ø",
    }


    def __init__(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è. –ü—Ä–∏–∫–æ–ª?"""
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "check_updates",
                True,
                lambda: "Check for updates on module load",
                validator=loader.validators.Boolean(),
            )
        )
        self.gozilla_bot = "@Gozilla_bot"
        self.gozilla_bot_id = 5229239434
        self.current_video_name = ""
        self.current_video_quality = ""
        self.current_video_author = ""
        self.current_url = ""
        self.update_message = ""

    def _is_youtube_url(self, url: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ URL YouTube URL –≤–∞–ª–∏–¥–Ω—ã–º
        
        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            url: –Æ—Ç—É–± URL
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            bool: True –µ—Å–ª–∏ URL —è–≤–ª—è–µ—Ç—Å—è YouTube URL –≤–∞–ª–∏–¥–Ω—ã–º, False –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ
        """
        youtube_patterns = [
            r'^(https?://)?(www\.)?(youtube\.com|youtu\.?be)/.+$',
            r'^(https?://)?(www\.)?youtube\.com/watch\?v=[\w-]+',
            r'^(https?://)?(www\.)?youtu\.be/[\w-]+',
            r'^(https?://)?(www\.)?youtube\.com/shorts/[\w-]+',
        ]
        return any(search(pattern, url) for pattern in youtube_patterns)

    def _reset_media_info(self) -> None:
        """–°–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –≤–∏–¥–µ–æ."""
        self.current_video_name = ""
        self.current_video_quality = ""
        self.current_video_author = ""

    @property
    def current_video_name(self) -> str:
        """–ü–æ–ª—É—á–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ."""
        return self._current_video_name

    @current_video_name.setter
    def current_video_name(self, value: str) -> None:
        """–°—Ç–∞–≤–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ."""
        self._current_video_name = value

    @property
    def current_video_quality(self) -> str:
        """–ü–æ–ª—É—á–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ."""
        return self._current_video_quality

    @current_video_quality.setter
    def current_video_quality(self, value: str) -> None:
        """–°—Ç–∞–≤–∏—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ."""
        self._current_video_quality = value

    @property
    def current_video_author(self) -> str:
        """–ü–æ–ª—É—á–∞–µ—Ç –∞–≤—Ç–æ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ."""
        return self._current_video_author

    @current_video_author.setter
    def current_video_author(self, value: str) -> None:
        """–°—Ç–∞–≤–∏—Ç –∞–≤—Ç–æ—Ä–∞ —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–µ–æ."""
        self._current_video_author = value

    @loader.loop(interval=10800, autostart=True, wait_before=False)
    async def check_for_updates(self) -> None:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∫–∞–∂–¥—ã–µ 3 —á–∞—Å–∞."""
        try:
            logger.info("[LazyYouTube | Update Checker] –ü—Ä–æ–≤–µ—Ä—è—é...")
            async with ClientSession() as session:
                async with session.get(UPDATE_URL) as response:
                    new_version_str = await response.text()
                    new_version_str = new_version_str.splitlines()[0].split("=")[1]
                    version_tuple = literal_eval(new_version_str)
                    if version_tuple > __version__:
                        self.update_message = self.strings["update_available"].format(
                            version=".".join(map(str, new_version_str)), url=UPDATE_URL
                        )
                        logger.info(
                            f"[LazyYouTube] New version available! {new_version_str} \n"
                            "Trying to update..."
                        )

                        await self.invoke("dlmod", UPDATE_URL, peer=self.logchat)
                    else:
                        self.update_message = ""
        except Exception as e:
            await logger.exception(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π: {e}")

    async def client_ready(self, client: CustomTelegramClient, db: Database) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–ª–∏–µ–Ω—Ç –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö."""
        self.client: CustomTelegramClient = client
        self.gozilla_bot: TypeInputPeer = await self.client.get_entity(
            "Gozilla_bot"
        )
        self.gozilla_bot_id: int = self.gozilla_bot.id

        history = await self.client(
            messages.SearchRequest(
                peer=self.gozilla_bot,
                q=" ",
                filter=InputMessagesFilterEmpty(),
                min_date=None,
                max_date=None,
                offset_id=0,
                add_offset=0,
                limit=0,
                max_id=0,
                min_id=0,
                hash=0,
            )
        )

        if not hasattr(history, "count"):
            await self.client.send_message(entity=self.gozilla_bot, message="/start")
            await utils.dnd(self.client, peer=PeerUser(841589476), archive=False)

    async def _find_by_url(self, name: str, mp3: bool = False, m: Optional[Message] = None) -> Optional[Message]:
        """–ù–∞—Ö–æ–¥–∏—Ç –≤–∏–¥–µ–æ –∏–ª–∏ –∞—É–¥–∏–æ –ø–æ URL.
        
        –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
            name: URL –≤–∏–¥–µ–æ
            mp3: –ï—Å–ª–∏ True, –∏—â–µ—Ç –∞—É–¥–∏–æ –≤–º–µ—Å—Ç–æ –≤–∏–¥–µ–æ
            m: Optional[Message] = None
            
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
            Optional[Message]: –°–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–∏–¥–µ–æ –∏–ª–∏ –∞—É–¥–∏–æ
            
        –û—à–∏–±–∫–∏:
            ValueError: –ï—Å–ª–∏ –∑–∞–º–µ—á–µ–Ω –∞–Ω—Ç–∏—Å–ø–∞–º
            YouBlockedUserError: –ï—Å–ª–∏ –±–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
        """
        processing_message: Optional[Message] = None
        media_message: Optional[Message] = None
        antispam_minutes: Optional[str] = None
        button_clicked: bool = False
        processing_complete = asyncio.Event()
        self.current_url: str = name
        
        @self.client.on(events.NewMessage(from_users=self.gozilla_bot_id))
        async def get_quality_handler(event: events.NewMessage.Event) -> None:
            """–õ–æ–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞."""
            nonlocal processing_message, media_message, antispam_minutes, m, button_clicked
            try:
                if event.message.from_id == self.gozilla_bot_id:
                    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–Ω—Ç–∏—Å–ø–∞–º
                    if "Antispam" in getattr(event.message, 'message', '') or "Antispam" in getattr(event, 'text', ''):
                        text = event.message.message if hasattr(event.message, 'message') else event.text
                        if match := search(r'(\d+)\s*minutes', text):
                            # –≠—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π -- –ø–∞—Å—Ö–∞–ª–∫–∞ :)
                            antispam_minutes = match.group(1)
                            try:
                                await utils.answer(
                                    m,
                                    self.strings("antispam").format(minutes=antispam_minutes) + self.update_message
                                )
                            except Exception as e:
                                logger.exception(f"[LazyYouTube] Error updating antispam message: {e}")
                            raise ValueError(f"antispam:{antispam_minutes}")
                        return

                    # –õ–æ–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–µ–≤—å—é (—Å–æ–¥–µ—Ä–∂–∏—Ç üëÅ)
                    if not button_clicked and event.message.photo and "üëÅ" in event.message.text:
                        button_clicked = True  # –û—Ç –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è
                        self._update_media_info(
                            name=event.message.text.split("\n")[0],
                            quality=event.message.reply_markup.rows[-2].buttons[0].text.split("-")[0][2:],
                            author=event.message.text.split("\n")[3][2:]
                        )
                        
                        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–æ—Ç–æ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                        try:
                            
                            # –ù–∞–∂–∏–º–∞–µ–º –Ω–∞ –∫–Ω–æ–ø–∫—É –∫–∞—á–µ—Å—Ç–≤–∞
                            await event.message.click((-2 if not mp3 else -1), 0)  # –Ω–∞–æ–±–æ—Ä–æ—Ç
                        except Exception as e:
                            logger.exception(f"[LazyYouTube] Error handling preview: {e}")
                            raise
                        return

                    # –õ–æ–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ–±—Ä–∞–±–æ—Ç–∫–µ
                    if "üë©‚Äçüî¨" in event.message.text:
                        await m.delete()
                        m = await utils.answer_file(
                            message=event.message,
                            file=event.message.photo,
                            caption=self.strings("downloading_" + ("audio" if mp3 else "video")).format(
                                name=self.current_video_name
                            )
                        )
                            
                        processing_message = event.message
                        return
                    
                    # –õ–æ–≤–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –≤–∏–¥–µ–æ –∏–ª–∏ –∞—É–¥–∏–æ
                    if (mp3 and event.message.audio) or (not mp3 and event.message.video):
                        media_message = event.message
                        # –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ –Ω–∞ –º–µ–¥–∏–∞
                        try:
                            await utils.answer_file(
                                message=m,
                                file=event.message.media,
                                caption=self.strings("your_" + ("audio" if mp3 else "video")).format(
                                    link=self.current_url,
                                    name=self.current_video_name,
                                    quality=self.current_video_quality if not mp3 else "",
                                    author=self.current_video_author,
                                ),
                                supports_streaming=True
                            )
                        except Exception as e:
                            logger.exception(f"[LazyYouTube] Error updating media message: {e}")
                            raise
                        finally:
                            processing_complete.set()
                        return
            except Exception as e:
                if isinstance(e, ValueError) and "antispam:" in str(e):
                    raise
                if not isinstance(e, MessageNotModifiedError):
                    logger.exception(f"[LazyYouTube] Error in quality handler:\n{e}")
                raise

        try:
            self.client.add_event_handler(get_quality_handler)
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç URL –≤ –±–æ—Ç–∞
            await self.client.send_message(self.gozilla_bot, name)
            await asyncio.sleep(0.5)
            
            try:
                await asyncio.wait_for(processing_complete.wait(), timeout=30)  # 30 —Å–µ–∫—É–Ω–¥ –æ–∂–∏–¥–∞–Ω–∏—è
            except asyncio.TimeoutError:
                logger.warning("[LazyYouTube] Processing timeout")
                return None
            
            return media_message
        finally:
            self.client.remove_event_handler(get_quality_handler)

    def _update_media_info(self, name: str, quality: str, author: str) -> None:
        """–û–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –º–µ–¥–∏–∞.
        
        Args:
            name: –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞
            quality: –ö–∞—á–µ—Å—Ç–≤–æ –º–µ–¥–∏–∞
            author: –ê–≤—Ç–æ—Ä –º–µ–¥–∏–∞
        """
        self.current_video_name = name
        self.current_video_quality = quality
        self.current_video_author = author

    @loader.command(alias="—é—Ç")
    async def yt(self, message: Message) -> None:
        """[url] - Downloading video from YouTube"""
        reply_to: Optional[Message] = await message.get_reply_message()
        
        if not (url := utils.get_args_raw(message)):
            if not reply_to or not (url := utils.get_args_raw(reply_to)):
                return await utils.answer(
                    message, self.strings("no_link") + self.update_message
                )
        
        if not self._is_youtube_url(url):
            return await utils.answer(
                message, self.strings("not_youtube") + self.update_message
            )

        try:
            m = await utils.answer(
                message, self.strings("searching_video") + self.update_message
            )
            
            if result := await self._find_by_url(name=url, mp3=False, m=m):
                await utils.answer_file(
                    message=m,
                    file=result,
                    supports_streaming=True,
                    caption=self.strings("your_video").format(
                        link=self.current_url,
                        name=self.current_video_name,
                        quality=self.current_video_quality,
                        author=self.current_video_author,
                    ),
                    reply_to=reply_to,
                )
                try:
                    await m.delete()
                except Exception as e:
                    logger.exception(f"[LazyYouTube] Error deleting message: {e}")
            else:
                await utils.answer(
                    message, self.strings("no_video") + self.update_message
                )

        except YouBlockedUserError:
            await utils.answer(message, self.strings["blocked_bot"] + self.update_message)
        except ValueError as e:
            if str(e).startswith("antispam:"):
                minutes = str(e).split(":")[1]
                await utils.answer(
                    message, 
                    self.strings("antispam").format(minutes=minutes) + self.update_message
                )
            else:
                logger.exception("[LazyYouTube] Unexpected ValueError in yt command")
                raise
        except Exception as e:
            logger.exception(f"[LazyYouTube] Error in yt command: {e}")
            raise

    @loader.command(alias="—é—Ç–º")
    async def ytm(self, message: Message) -> None:
        """[url] - Downloading audio from YouTube"""
        reply_to: Optional[Message] = await message.get_reply_message()
        
        if not (url := utils.get_args_raw(message)):
            if not reply_to or not (url := utils.get_args_raw(reply_to)):
                return await utils.answer(
                    message, self.strings("no_link") + self.update_message
                )

        if not self._is_youtube_url(url):
            return await utils.answer(
                message, self.strings("not_youtube") + self.update_message
            )

        try:
            m = await utils.answer(
                message, self.strings("searching_audio") + self.update_message
            )

            if result := await self._find_by_url(name=url, mp3=True, m=m):
                await utils.answer_file(
                    message=m,
                    file=result,
                    supports_streaming=True,
                    caption=self.strings("your_audio").format(
                        link=self.current_url,
                        name=self.current_video_name,
                        author=self.current_video_author,
                    ),
                    reply_to=reply_to,
                )
                try:
                    await m.delete()
                except Exception as e:
                    logger.exception(f"[LazyYouTube] Error deleting message: {e}")
            else:
                await utils.answer(
                    message, self.strings("no_audio") + self.update_message
                )

        except YouBlockedUserError:
            await utils.answer(message, self.strings["blocked_bot"] + self.update_message)
        except ValueError as e:
            if str(e).startswith("antispam:"):
                minutes = str(e).split(":")[1]
                await utils.answer(
                    message, 
                    self.strings("antispam").format(minutes=minutes) + self.update_message
                )
            else:
                logger.exception("[LazyYouTube] Unexpected ValueError in ytm command")
                raise
        except Exception as e:
            logger.exception(f"[LazyYouTube] Error in ytm command: {e}")
            raise
